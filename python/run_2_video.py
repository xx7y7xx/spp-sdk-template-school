# coding=utf-8import os, sys, codecsimport shutilimport commonimport configimport bucfg# import checkbuild# import run_100_log########################################## 处理校园介绍中的视频集def process():	print '-------------------------------'	print common.encodeChinese('>> 处理视频集')	print ''		# 前面已经检查过文件存在了，这里就不需要检查了		videoDir = "%svideo\\"%(bucfg.productDir)	# if not os.path.isdir(videoDir):		# run_100_log.message += common.encodeChinese("\n缺少视频文件.................")		# checkbuild.checkReqFile(videoDir)	if not os.path.isdir(videoDir):		print common.encodeChinese('没有发现视频数据，跳过处理')		return 		jsonString = 'VIDEO_FREQUENCY={'		cateIndex = 0		cateList = os.listdir(videoDir)	for cate in cateList:		if cate.find(".svn")>-1:			continue			jsonString += "\n\t\""+str(cateIndex)+"\" : {"				names = cate.split("@")				jsonString += "\n\t\t\"chinese\" : " + "\""+names[1]+"\","		jsonString += "\n\t\t\"english\" : " + "\""+names[2]+"\","		jsonString += "\n\t\t\"genus\" : [ "				videoList = os.listdir(videoDir + cate)		for video in videoList:			if video.find(".svn")>-1:				continue			names = video.split("@")			videoName = video.split('.')[0]			videoFile= videoDir + cate + "\\" + videoName + ".txt"							if os.path.isfile(videoFile):				url = common.readFileFirstLine(videoFile)							if common.getFilenameExt(video)!=".txt" and not os.path.isfile(videoFile):				url = names[2]			if(common.getFilenameExt(video)!=".txt" and  os.path.isfile(videoFile)):				print common.encodeChinese("------------------------------")				print common.encodeChinese("出错了！")				print common.encodeChinese("请查看视频文件")+videoDir+cate				print common.encodeChinese("")				print common.encodeChinese("txt和视频文件只能其中一个...")								os._exit(0)							jsonString += "\n\t\t\t{"			jsonString += "\n\t\t\t\t\"chinese\" : " + "\""+names[1]+"\","			jsonString += "\n\t\t\t\t\"english\" : " + "\""+names[2].split('.')[0]+"\","			jsonString += "\n\t\t\t\t\"url\" : " + "\""+url+"\""			jsonString += "\n\t\t\t},"						# 拷贝视频文件									if not os.path.exists(videoFile): #若没有txt				srcFile = videoDir + cate + "\\"+video				newFile = "%sui\\website\\video\\%s"%(bucfg.targetDir, url)								shutil.copyfile(srcFile, newFile)						jsonString += '''\n\t\t\t{				"chinese" : "",				"english" : "",				"url" : ""			},'''		jsonString += "\n\t\t]"				jsonString += "\n\t},"				cateIndex += 1		if len(cateList)==0:		jsonString += "\n\t\"0\" : {"		jsonString += "\n\t\t\"chinese\" : " + "\"\","		jsonString += "\n\t\t\"english\" : " + "\"\","		jsonString += "\n\t}"		jsonString += '\n}'		newFilePath = "%sjson\\video_frequency.js"%(bucfg.targetDir)	common.writeNewFile(newFilePath, jsonString.decode("gbk").encode("utf8"))	print ''		# '''  "0": {            # "chinese": "视频集一",             # "english": "video_1",			# "genus" : [				# {					# "chinese": "视频集一/1", 					# "english": "video_1/1",					# "url" : "shiping1_1.swf"				# },				# {					# "chinese": "视频集一/2", 					# "english": "video_1/2",					# "url" : "shiping1_2.swf"				# },				# {					# "chinese": "视频集一/3", 					# "english": "video_1/3",					# "url" : "shiping1_3.swf"				# }			# ]        # }, 	'''