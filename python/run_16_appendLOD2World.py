# coding=utf-8import os,sysfrom xml.dom.minidom import parsefrom xml.dom.minidom import parseStringimport shutilimport run_15_appendWorldxmlimport configimport commonimport bucfg#--------------------------------------------------------------		# 向 world 文件中写入角色、天空、环境光、太阳光等节点# 角色和音乐节点添加到 world.xml 中# 添加一个LOD方案的标签def createLODElement(dom,node,meshPlgPar):	if len(meshPlgPar)>0:		nullmesh = dom.createElement("nullmesh")		staticlod = dom.createElement("staticlod")		distance = dom.createElement("distance")		meshobj = dom.createElement("meshobj")		meshobj2 = dom.createElement("meshobj")		lodlevel = dom.createElement("lodlevel")			distance.setAttribute(" d0","70")		meshobj.setAttribute(" name","lod_01")		meshobj2.setAttribute(" name","lod_02")				staticlod.appendChild( dom.createTextNode('\n\t\t'))		staticlod.appendChild(distance)		staticlod.appendChild( dom.createTextNode('\n\t'))		node.appendChild( dom.createTextNode('\n\t'))		meshobj.appendChild( dom.createTextNode('\n\t\t'))		meshobj.appendChild(run_15_appendWorldxml.createTagText(dom,"lodlevel","1"))		meshobj.appendChild(run_15_appendWorldxml.createTagText(dom,"priority","object"))		meshobj.appendChild( dom.createTextNode('\n\t\t'))		meshobj.appendChild(meshPlgPar[0])		meshobj.appendChild( dom.createTextNode('\n\t\t'))		meshobj.appendChild(meshPlgPar[1])		meshobj.appendChild( dom.createTextNode('\n\t'))				if len(meshPlgPar)>3:			meshobj.appendChild(meshPlgPar[3])			meshobj.appendChild( dom.createTextNode('\n\t'))				node.appendChild( dom.createTextNode('\n\t'))		meshobj2.appendChild( dom.createTextNode('\n\t\t'))		meshobj2.appendChild(run_15_appendWorldxml.createTagText(dom,"lodlevel","2"))		meshobj2.appendChild( dom.createTextNode('\n\t\t'))		meshobj2.appendChild(createNullMesh(dom))		meshobj2.appendChild( dom.createTextNode('\n\t'))		node.appendChild( dom.createTextNode('\n\t'))				node.appendChild(createNullMesh(dom))		node.appendChild( dom.createTextNode('\n\t'))		node.appendChild(staticlod)		node.appendChild( dom.createTextNode('\n\t'))		node.appendChild(meshobj)		node.appendChild( dom.createTextNode('\n\t'))		node.appendChild(meshobj2)		node.appendChild( dom.createTextNode('\n\t'))				node.appendChild(meshobj2)		node.appendChild(meshPlgPar[2])		node.appendChild( dom.createTextNode('\n\t'))		#创建nullmesh标签		def createNullMesh(dom):	nullmesh = dom.createElement("nullmesh")	min = dom.createElement("min")	max = dom.createElement("max")	min.setAttribute("x","-1")	min.setAttribute("y","0")	min.setAttribute("z","-1")		max.setAttribute("x","1")	max.setAttribute("y","2")	max.setAttribute("z","1")		nullmesh.appendChild( dom.createTextNode('\n\t\t'))	nullmesh.appendChild(min)	nullmesh.appendChild( dom.createTextNode('\n\t\t'))	nullmesh.appendChild(max)	nullmesh.appendChild( dom.createTextNode('\n\t'))	return nullmeshdef process():		print '-------------------------------'	print common.encodeChinese('>> LOD方案修正中，所以跳过... ')	print ''		# worldFilePath = "%s\\target\\art\\world.xml"%(config.PROJECT_HOME)	# worldDoc = parse( worldFilePath )	# worldRoot = worldDoc.getElementsByTagName("world")[0]	# meshobj = worldDoc.getElementsByTagName("meshobj")	# nullmesh = worldDoc.getElementsByTagName("nullmesh")	# if len(nullmesh)<1: #如果没有添加过LOD否则不添加		# for mesh in meshobj:			# meshPlgPar=[]			# if mesh.getAttribute("name").find("#")>0 and "g" not in mesh.getAttribute("name"):#带#号说明是建筑的meshobj				# for meshobj in mesh.childNodes:					# if meshobj.nodeName=="plugin":						# meshPlgPar.append(meshobj)					# if meshobj.nodeName=="params": 						# meshPlgPar.append(meshobj)												# if meshobj.nodeName=="move": 						# meshPlgPar.append(meshobj)					# if meshobj.nodeName=="trimesh": 						# meshPlgPar.append(meshobj)					# createLODElement(worldDoc,mesh,meshPlgPar)							#####################将新的 world 文件重新写入			# f =  open( worldFilePath ,  'w')			# worldDoc.writexml(f , encoding='utf-8' )			# f.close()		# print 	"ok.................."				# 读取world.xml	#openXml	# for 	# 读取建筑的meshobj信息 检索带#号的meshobj	#添加nullmesh的标签 并且将 <plugin>crystalspace.mesh.loader.genmesh</plugin>	#<params>      #  <factory>o179</factory>      #</params>	  # 移到nullmesh 下		# 重写的xml写回文件  取到所有建筑的meshobj的话，然后遍历他们的子节点，有plugin和params的标签的，把他们村指导一个数组中，另外我小西瓜	# node.appendChild(createTagText(dom,"file",text))	# node.appendChild(dom.createTextNode('\n\t'))							# <nullmesh>             # <min x="-1" y="0" z="-1" />              # <max x="1" y="2" z="1" />         # </nullmesh>         # <staticlod>             # <distance d0="10" d1="30"  />          # </staticlod>         # <meshobj name='lod_01'>             # <lodlevel>0</lodlevel>			 # <priority>object</priority>             # <plugin>genmesh</plugin>             # <params>                 # <factory>o08</factory>             # </params>        # </meshobj>        # <meshobj name='lod_02'>            # <lodlevel>1</lodlevel>             # <nullmesh>                # <min x="-1" y="0" z="-1" />  position：128.32249450683594, -1.1920928955078125e-7, -353.5993                # <max x="1" y="2" z="1" /> position：125.49960327148438, 0, -149.36839294433594            # </nullmesh>         # </meshobj>